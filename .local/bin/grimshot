#!/bin/sh

getTargetDir() {
	picdir=$(xdg-user-dir PICTURES 2>/dev/null)
	target=${picdir:-~}/screenshots
	[ -d "$target" ] || mkdir "$target"
	echo "$target"
}

subject=$1 # all | area
target=$2 # file | clipboard

if [ "$subject" = 'area' ]; then
	area=$(slurp -d 2>/dev/null)
	[ -z "$area" ] && exit 0 # area selection was canceled
elif [ "$subject" != 'all' ]; then
	echo "$(basename "$0"): Invalid subject" 1>&2
	exit 1
fi

if [ "$target" = 'file' ]; then
	file=$(getTargetDir)/$(date -Iseconds).png
	if [ -n "$area" ]; then
		grim -g "$area" "$file"
	else
		grim "$file"
	fi
	notify-send --icon="$file" 'Screenshot' "$(basename "$file")"
elif [ "$target" = 'clipboard' ]; then
	if [ -n "$area" ]; then
		grim -g "$area" - | wl-copy --type image/png
	else
		grim - | wl-copy --type image/png
	fi
	notify-send 'Screenshot' 'Copied to clipboard'
else
	echo "$(basename "$0"): Invalid target" 1>&2
	exit 1
fi
